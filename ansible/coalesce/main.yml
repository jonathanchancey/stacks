---
- name: Run shared setup tasks
  hosts: "*"
  become: true
  roles:
    - role: shared

- name: Setup RKE2 on servers
  vars_files:
    - ./group_vars/./group_vars/secret.yml
  hosts: server
  gather_facts: yes
  roles:
    - role: controlplane

- name: Setup RKE2 on agents
  vars_files:
    - ./group_vars/secret.yml
  gather_facts: yes
  hosts: agents
  roles:
    - role: agents

- name: Prepare kubeconfig and run k8s and helm setup
  vars_files:
    - ./group_vars/secret.yml
  hosts: localhost
  roles:
    - role: local
