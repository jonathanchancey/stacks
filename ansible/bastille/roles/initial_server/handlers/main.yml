---
- name: ensure rke2-server is running
  become: true
  systemd:
    state: started
    enabled: true
    name: rke2-server
  listen: "rke2-server service start"

- name: ensure rke2-server is restarted
  become: true
  systemd:
    state: restarted
    name: rke2-server
  listen: "rke2-server service restart"
# - name: obtain node-token
#   become: true
#   ansible.builtin.fetch:
#     src: /var/lib/rancher/rke2/server/node-token
#     dest: autogenerated/node-token
#     flat: yes
#   listen: "rke2-server service start"
- name: obtain kubeconfig
  ansible.builtin.fetch:
    src: /etc/rancher/rke2/rke2.yaml
    dest: autogenerated/rke2.yaml
    flat: yes
  listen: "rke2-server service start"
