# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/main/charts/library/common/values.schema.json
## This chart relies on the common library chart from bjw-s
## You can find it at https://github.com/bjw-s/helm-charts/tree/main/charts/library/common
## Refer there for more detail about the supported values
# These entries are shared between all the Immich components
env:
    IMMICH_MEDIA_LOCATION: /usr/src/app/upload
    # IMMICH_LOG_LEVEL: debug
    REDIS_HOSTNAME: '{{ printf "%s-redis-master" .Release.Name }}'
    DB_HOSTNAME: '{{ .Release.Name }}-postgresql'
    DB_USERNAME: '{{ .Values.postgresql.global.postgresql.auth.username }}'
    DB_DATABASE_NAME: '{{ .Values.postgresql.global.postgresql.auth.database }}'
    DB_PASSWORD: '{{ .Values.postgresql.global.postgresql.auth.password }}'
    IMMICH_MACHINE_LEARNING_URL: '{{ printf "http://%s-machine-learning:3003" .Release.Name }}'
image:
    tag: v1.107.2
immich:
    metrics:
        # Enabling this will create the service monitors needed to monitor immich with the prometheus operator
        enabled: true
    persistence:
        # Main data store for all photos shared between different components.
        library:
            # Automatically creating the library volume is not supported by this chart
            # You have to specify an existing PVC to use
            existingClaim: personal-nfs-pvc
            globalMounts:
                - path: /usr/src/app/upload
    # configuration is immich-config.json converted to yaml
    # ref: https://immich.app/docs/install/config-file/
    #
    configuration: {}
    # trash:
    #   enabled: false
    #   days: 30
    # storageTemplate:
    #   enabled: true
    #   template: "{{y}}/{{y}}-{{MM}}-{{dd}}/{{filename}}"
# Dependencies
postgresql:
    enabled: true
    image:
        repository: tensorchord/pgvecto-rs
        tag: pg14-v0.2.0
    global:
        storageClass: longhorn
        postgresql:
            auth:
                username: ENC[AES256_GCM,data:XKs9FISrdzU=,iv:kaO02PcB3AjKwQX6I8puZ7kGXX3OAZ3uG+nItvX4oEg=,tag:5TqfremBzaX/1r+4mw02qg==,type:str]
                database: immich
                password: ENC[AES256_GCM,data:cdFaH0fEuijUmOMPEWQ2TQeLrXuo4bwJBrplkQpcZsA=,iv:yB40I9XHhJSQfdakb6ImLqDfajb/aGwLVJE24HCANT4=,tag:Fha3EMrVlGFLPvQq5trKpQ==,type:str]
    primary:
        initdb:
            scripts:
                create-extensions.sql: |
                    CREATE EXTENSION cube;
                    CREATE EXTENSION earthdistance;
                    CREATE EXTENSION vectors;
redis:
    enabled: true
    architecture: standalone
    global:
        storageClass: longhorn
    auth:
        enabled: false
# Immich components
server:
    enabled: ENC[AES256_GCM,data:acQZzg==,iv:PgKIjVA6vzceCYRmNiLjtpilTrUHJ5VVOljZPBdJIvg=,tag:eWdnBwzWWmxGEBwH10ZNkw==,type:bool]
    image:
        repository: ENC[AES256_GCM,data:Yl6gHi4LH47GKlz4xEQeLf3MqH74XTPgNRYnPw9tqY0=,iv:b2HxCAdVIhJcQyVlX4XNcsy2idwjqYGxTBN2KZ7U1nc=,tag:g1Y9e4J3B4tO7BQlF5FUjg==,type:str]
        pullPolicy: ENC[AES256_GCM,data:hp9MXnJxAIiv2hXi,iv:9LWHzdE1GcTT2ZIxBGwzVvWsl6/9P0qKAPB1vizFfXs=,tag:b7Fzzs7c2QYq34WZ3eEslw==,type:str]
    ingress:
        main:
            enabled: ENC[AES256_GCM,data:QKYFbpU=,iv:jYAkmqImWazdb28EY0319lNdvt9kFcXcRV4KHRxDeGk=,tag:Qk5Tw7RKrQiJn/ud/T/9VQ==,type:bool]
            annotations:
                #ENC[AES256_GCM,data:14LM3AbnhLNtfvn5NGvVGFR9VCuQ6UpRZAHV/fMko9jXXOjPDsDAO7f3JzsKoHzAA/t3cD3055vCEs6aWRp7NRpfu21H,iv:h616G8xGg9jgW+CbYKYZoVPQVeX7xLHPZqzWkopFDxg=,tag:i+DAo4HqzYzLRVFcSCLPUQ==,type:comment]
                nginx.ingress.kubernetes.io/proxy-body-size: ENC[AES256_GCM,data:lA==,iv:K38lZSbfLLPYPgYrjtc+i9qaOq/d4IWq83ofTfV9TTQ=,tag:FzU8fJSA22wvkz/zIeapDQ==,type:str]
            hosts:
                - host: ENC[AES256_GCM,data:pl+6kCj92sOVHEGd,iv:vuLngRLJzTAbbfO5lqkeGo/UCMkh61NarYBhrH3jx9g=,tag:rqYRikk9znZVn0z+xLWLTg==,type:str]
                  paths:
                    - path: ENC[AES256_GCM,data:CA==,iv:OWVH8LGbcosJurLX7CXN7dt3MlaWpA15rN85yZE8avs=,tag:xS0FDqhwdYyEmi/JxLgDkw==,type:str]
            tls: []
machine-learning:
    enabled: true
    image:
        repository: ghcr.io/immich-app/immich-machine-learning
        pullPolicy: IfNotPresent
    env:
        TRANSFORMERS_CACHE: /cache
    persistence:
        cache:
            enabled: true
            size: 10Gi
            # Optional: Set this to pvc to avoid downloading the ML models every start.
            type: emptyDir
            accessMode: ReadWriteMany
            storageClass: local-path
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1rl8s5e3al83x28ecwpn7ed3773uvyuhhvqujc47dz4chpw7xvc6qlzd8hq
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBPVFIwbHlrMWNocit1VGVm
            OWEwS1dIdFp4TFFFc2s1cmxVTXRGU2lQZkNRCnhaeVM5dTlaVVhKYkhWRUliYnBK
            Tm1ROEFKZmJzVWNHa2hqRHRQNGJXMjgKLS0tIFVUazlwWmlPZXFVazBMQzU3Qzda
            ekJKN0pROVJCTFF5bzVNU05iODFnbkEKu+cs5BNiZR80qz0dm75pGPAbROeCQZwH
            eLJW3pt3QEbnwhuLh1ESaAIK8av0Od8pOp14uuj0k2Imn9vWUq3Tww==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-07-03T18:54:53Z"
    mac: ENC[AES256_GCM,data:yB+Vk64kfnrlqg/ZOO5tIWVvZ50s2UkmES2el39eRAjAnf+rqeMMmFqDezqyqaja22EV4Ly3zjgfaXStKH4cik6+NMSEIjMWQ92GJvpIyuIp3XKk3mf5ODKIM5idkY5n6JXvoN2UTMjyf/yZ5h5F0JFpzV06l57w4eWwmeuGqC8=,iv:mGJlu5j999/0HqA1Z2yqai3gv/S+2jw1uSxf0UBUw0Q=,tag:7kY4XQ6wlHpw9nhjFk5TWQ==,type:str]
    pgp: []
    encrypted_regex: ^(username|password|user|pass|id|key|secret|server)$
    version: 3.9.0
