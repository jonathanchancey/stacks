- name: install rke2
  hosts: "server"
  tasks:
    - name: install rke2 server
      become: true
      command: transactional-update run bash -c 'curl -sfL https://get.rke2.io | sh -'
    - name: Reboot the nodes
      become: true
      reboot:
        reboot_timeout: 300
    - name: enable rke2-server service
      become: true
      command: transactional-update run bash -c 'systemctl enable rke2-server.service'
    - name: start rke2-server service in current session
      become: true
      command: systemctl start rke2-server.service
    - name: obtain node-token
      ansible.builtin.fetch:
        src: /var/lib/rancher/rke2/server/node-token
        dest: autogenerated/node-token
        flat: yes
    # - name: Reboot the nodes
    #   become: true
    #   reboot:
    #     reboot_timeout: 300
